<html lang="en" xmlns:th="http://www.thymeleaf.org">
<!-- 头部信息 -->
<head th:fragment="head(title)">
    <title th:text="${title}"></title>
    <meta charset="utf-8"/>
    <meta name="renderer" content="webkit|ie-comp|ie-stand"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="Bookmark" th:href="@{/favicon.ico}"/>
    <link rel="Shortcut Icon" th:href="@{/favicon.ico}"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/layui.css}" media="all"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/index.css}" th:unless="${#request.servletPath.startsWith('/admin')}"/>
    <script type="text/javascript" th:src="@{/js/layui.js}"></script>
    <!--[if lt IE 9]>
    <script type="text/javascript" th:src="@{/js/html5shiv.js}"></script>
    <script type="text/javascript" th:src="@{/js/respond.min.js}"></script><![endif]--><!--[if IE 6]>
    <script type="text/javascript" th:src="@{/js/DD_belatedPNG_0.0.8a-min.js}"></script>
    <script type="text/javascript">DD_belatedPNG.fix('*');</script><![endif]-->
    <script type="text/javascript" th:src="@{/js/lay-config.js}" th:if="${#request.servletPath.startsWith('/admin')}"></script>
    <script type="text/javascript" th:unless="${#request.servletPath.startsWith('/admin')}">
        function layPage(id, count, curr, limit) {
            layui.laypage.render({
                elem: id, count: count, curr: curr || 1, limit: limit || 12, theme: '#B55AD0',
                first: '首页', last: '尾页', prev: '<em>←</em>', next: '<em>→</em>', jump: function (obj, first) {
                    if (!first) {
                        console.log(window.location.pathname)
                        // window.location.href = window.location.pathname
                    }
                }
            });
        }

        layui.use(['jquery', 'element', 'form', 'carousel', 'dropdown'], function ($, element, form, carousel, dropdown) {
            var pageMap = {
                '/': 'home', '/index': 'home', '/index.html': 'home',
                '/room': 'rooms', '/room.html': 'rooms',
                '/rooms': 'rooms', '/rooms.html': 'rooms',
                '/learns': 'learns', '/learns.html': 'learns',
                '/comment': 'comments', '/comment.html': 'comments',
                '/comments': 'comments', '/comments.html': 'comments',
                '/tools': 'tools', '/tools.html': 'tools',
                '/user/answers': 'users', '/user/answers.html': 'users',
                '/user/account': 'users', '/user/account.html': 'users',
                '/user/adjust': 'users', '/user/adjust.html': 'users',
            };
            // 获取当前页面标识
            var dataPageKey = pageMap[window.location.pathname] || 'home';
            // 移除所有active状态
            $('.layui-nav-item').removeClass('layui-this');
            // 设置当前active状态
            $('#mainNav .layui-nav-item[data-page="' + dataPageKey + '"]').addClass('layui-this');
            // 重新渲染
            element.init();
            // 首页横幅
            carousel.render({elem: '#banner', height: '300px', width: '100%', interval: 3000, anim: 'fade', arrow: 'hover', indicator: 'outside'});

            function layOpen(title, url, lo_w, lo_h) {
                lo_w = typeof lo_w === 'undefined' ? '50%' : lo_w;
                lo_h = typeof lo_h === 'undefined' ? '50%' : lo_h;
                layer.open({type: 2, title: title, area: [lo_w, lo_h], content: url, shade: 0.8});
            }

            // 初始化栏目
            function layDrop(clazz, datas, url) {
                dropdown.render({
                    elem: clazz, trigger: 'hover', data: datas || [], click: function (data, othis, event) {
                        window.location.href = url + data.id;
                    }
                });
            }

            // 学科初始化
            $.get('/subjects', function (res) {
                layDrop('.LAY_TRIGGER', res.data, "/rooms?sid=");
                layDrop('.LAY_TRIG', res.data, "/learns?sid=");
            }, 'json');
            // 答题室按钮
            $('.rooms').on('click', '.layui-btn', function (e) {
                e.stopPropagation();
                var $btn = $(this);
                var roomId = $btn.closest('.layui-card').parent().data('roomId');
                if ($btn.hasClass('layui-border-purple')) {
                    console.log("答题室" + roomId)
                    window.location.href = "/room?id=" + roomId;
                } else if ($btn.hasClass('layui-border-orange')) {
                    console.log("报告" + roomId)
                } else if ($btn.hasClass('layui-border-red')) {
                    console.log("阅卷" + roomId)
                }
            });
            // 用户操作
            $('#mainNav').on("click", "*[lay-event]", function (e) {
                switch ($(this).attr("lay-event")) {
                    case 'login':
                        layOpen('用户登录', '/user/login', '360px', '260px');
                        break;
                    case 'userInfo':
                        layOpen('<i class="layui-icon">&#xe66f; 基本资料</i>', '/user/account');
                        break;
                    case 'userPwd':
                        layOpen('<i class="layui-icon">&#xe673; 修改密码</i>', '/user/adjust');
                        break;
                }
            });

            $(".mobile-header-more").on("click", function () {
                $("body").addClass("mobile-nav-show").css("overflow", "hidden");
                $("#mobile-menu").removeClass('layui-icon-spread-left').addClass('layui-icon-shrink-right');
            })
            $(".site-mobile-shade").click(function () {
                $("body").removeClass("mobile-nav-show").css("overflow", "auto");
                $("#mobile-menu").removeClass('layui-icon-shrink-right').addClass('layui-icon-spread-left');
            });
        });
    </script>
</head>
<!-- 头部信息 -->
<div th:fragment="header">
    <div class="layui-header">
        <div class="layui-logo">
            <img th:src="@{/images/logo.png}" alt="logo" style="margin-left: -5px;"/>
            <cite>管理系统</cite>
        </div>
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item">
                <a lay-event="flexible" title="侧边伸缩" lay-unselect>
                    <i class="layui-icon layui-icon-shrink-right"></i>
                </a>
            </li>
            <span class="layui-breadcrumb layui-anim layui-anim-up">
                <a><cite>首页</cite></a>
            </span>
        </ul>
        <ul class="layui-nav layui-layout-right" lay-unselect>
            <li class="layui-nav-item">
                <a href="/" target="_blank" title="文档说明">
                    <i class="layui-icon layui-icon-website"></i>
                </a>
            </li>
            <li class="layui-nav-item">
                <a id="layFull" lay-event="screenLayFull" lay-full="full" title="全屏">
                    <i class="layui-icon layui-icon-screen-full"></i>
                </a>
            </li>
            <li class="layui-nav-item user-selection">
                <a>
                    <img th:src="@{/images/logo.png}" class="layui-nav-img" alt="头像">
                    <cite th:text="${session?.username?:'用户'}"></cite>
                </a>
                <dl class="layui-nav-child">
                    <dd><a lay-event="profile">基本资料</a></dd>
                    <dd><a lay-event="editPwd">修改密码</a></dd>
                    <hr>
                    <dd><a th:href="@{/logout}">退出</a></dd>
                </dl>
            </li>
        </ul>
    </div>
</div>

<!-- 尾部信息 -->
<div th:fragment="footer">
    <div class="layui-footer">
        <p>© 2025 <a href="#" target="_blank" style="color: #3498db;">做题吧</a> 版权所有 | 冀ICP备12345678号</p>
    </div>
    <!-- 移动端遮罩 -->
    <div class="site-mobile-shade"></div>
</div>

<div th:fragment="main_head">
    <header id="mainNav" class="layui-header">
        <div class="layui-row">
            <div class="mobile-logo"><img th:src="@{/images/logo.png}" alt="logo"/> 做题吧</div>
            <div class="mobile-header-more">
                <i id="mobile-menu" class="layui-icon layui-icon-spread-left"></i>
            </div>
            <div class="mobile-header-menu">
                <ul class="layui-nav" id="LAY_NAV_TOP" lay-nav-id="LAY_NAV_TOP">
                    <li class="layui-nav-item" data-page="home">
                        <a href="/">首页</a>
                    </li>
                    <li class="layui-nav-item LAY_TRIGGER" data-page="rooms">
                        <a href="/rooms">课程中心 <i class="layui-icon">&#xe61a;</i></a>
                    </li>
                    <li class="layui-nav-item LAY_TRIG" data-page="learns">
                        <a href="/learns">知识库 <i class="layui-icon">&#xe61a;</i></a>
                    </li>
                    <li class="layui-nav-item" data-page="comments">
                        <a href="/comment">问答社区</a>
                    </li>
                    <li class="layui-nav-item" data-page="tools">
                        <a href="/tools">常用工具</a>
                    </li>
                    <li class="layui-nav-item layui-layout-right" th:unless="${session?.username!= null}">
                        <a lay-event="login" href="javascript:;" style="color: #fff;">
                            <i class="layui-icon layui-icon-username"></i> 登录
                        </a>
                    </li>
                </ul>
                <ul class="layui-nav layui-layout-right" style="width: 150px!important;" th:if="${session?.username!= null}">
                    <li class="layui-nav-item" data-page="users">
                        <a href="javascript:;">
                            <img th:src="@{/images/logo.png}" class="mobile-nav-img" alt="头像">
                            <cite th:text="${session?.username?:'用户'}"></cite>
                        </a>
                        <dl class="layui-nav-child">
                            <dd>
                                <a th:href="@{/user/answers}" lay-event="userAns"><i class="layui-icon">&#xe705;</i> 我的答题室</a>
                            </dd>
                            <dd>
                                <a href="javascript:;" lay-event="userInfo"><i class="layui-icon">&#xe66f;</i> 基本资料</a>
                            </dd>
                            <dd>
                                <a href="javascript:;" lay-event="userPwd"><i class="layui-icon">&#xe673;</i> 修改密码</a>
                            </dd>
                            <hr>
                            <dd><a th:href="@{/logout}"><i class="layui-icon">&#xe682;</i> 退出</a></dd>
                        </dl>
                    </li>
                </ul>
            </div>
        </div>
    </header>
</div>

<div th:fragment="main_foot">
    <div class="index-footer">
        <div class="layui-col-md5 layui-col-md-offset1 layui-col-xs-offset1">
            <div class="layui-font-20">
                <img class="logo-footer" src="/images/logo.png" alt="logo"/> 做题吧平台
            </div>
            <div class="layui-font-14" style="color: #bdc3c7; line-height: 1.6; margin: 10px 40px 10px 0;">
                专注于提供高质量的在线做题平台，帮助您实现成长。我们致力于为用户提供最优质的学习体验。
            </div>
        </div>
        <div class="layui-col-md5 layui-col-md-offset1 layui-col-xs-offset1">
            <div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
                <div class="layui-font-16">学习资源</div>
                <div class="layui-font-14">
                    <a href="/rooms">课程中心</a>
                    <a href="/learns">知识文库</a>
                </div>
            </div>
            <div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
                <div class="layui-font-16">服务支持</div>
                <div class="layui-font-14">
                    <a href="#">帮助中心</a>
                    <a href="#">常见问题</a>
                    <a href="#">联系我们</a>
                </div>
            </div>
            <div class="layui-col-xs4 layui-col-sm4 layui-col-md4">
                <div class="layui-font-16">关于我们</div>
                <div class="layui-font-14">
                    <a href="#">公司介绍</a>
                    <a href="#">加入我们</a>
                    <a href="#">隐私政策</a>
                </div>
            </div>
        </div>
        <th:block th:include="include :: footer"></th:block>
    </div>
</div>
</html>