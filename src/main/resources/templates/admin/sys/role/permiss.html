<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="include :: head('设置角色')"></head>
<body>
<div class="yadmin-body animated fadeIn">
    <div class="layui-card layui-form layui-form-pane">
        <input type="hidden" name="roleId" th:value="${roleId}" />
        <input type="hidden" id="menus" name="menus" th:value="${menuIds}" />
        <div class="layui-form-item">
            <input class="layui-input" id="searchInput" value="" placeholder="输入查询节点内容...">
        </div>
        <div class="layui-form-item">
            <button class="layui-btn layui-btn-normal table-action">查询</button>
            <button class="layui-btn layui-btn-normal" dtree-id="menuTree" dtree-menu="moveDown">展开全部</button>
            <button class="layui-btn layui-btn-normal" dtree-id="menuTree" dtree-menu="moveUp">收缩全部</button>
        </div>
        <div class="layui-form-item">
            <ul id="menuTree" class="dtree" data-id="-1" data-value="选择权限"></ul>
        </div>
        <div class="layui-form-item layui-layout-admin">
            <div class="layui-input-block">
                <div class="layui-footer">
                    <button class="layui-btn" lay-submit="" lay-filter="submit-form">保存</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
layui.use(['jquery', 'dtree', 'form', 'layer', 'laydate'], function ($, dtree, form, layer, laydate) {
    dtree.render({
        elem: "#menuTree",
        url: "/admin/res/tree",
        method: "post",
        checkbar: "true",
        checkbarFun: {
            chooseDone: function (checkbarNodesParam) {
                $('#menus').val(dtree.getCheckedIds("menuTree"));
                return;
            }
        },
        initLevel: 2,
        dataStyle: "layuiStyle",
        dataFormat: "list",
        ficon: ["1", "1"],
        response: {
            statusCode: 0,
            message: "msg",
            title: "name",
            CheckArr: "data"
        },
        menubar: true,
        menubarTips: {
            toolbar: ["moveDown", "moveUp"],
            group: []
        },
        done: function (data, obj, first) {
            if (first) {
                dtree.chooseDataInit("menuTree", $('#menus').val());
                dtree.selectVal("menuTree");
            }
        }
    });
    
    form.on('submit(submit-form)', function (obj) {
        console.log(obj.field)
        $.ajax({
            type: "POST",
            url: '/admin/role/saveAssign',
            data: obj.field,
            dataType: 'json',
            cache: false,
            success: function (data) {
                advices(data, parent);
            },
            error: function (event) {
                toError(event);
            }
        });
    });
});
</script>
</body>
</html>