<!DOCTYPE HTML>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="include :: head('题库列表')"></head>
<body>
<div class="layui-card">
    <div class="layui-card-body">
        <div class="yadmin-body animated fadeIn">
            <div class="layui-form yadmin-search-area input">
                <form class="layui-form-item">
                    <div class="layui-inline">
                        <label for="name" class="layui-form-label">名称</label>
                        <div class="layui-input-inline">
                            <input type="text" name="name" id="name" placeholder="名称" class="layui-input"/>
                        </div>
                        <button lay-submit="" lay-filter="search" class="layui-btn layui-btn-sm layui-btn-primary table-action">
                            <i class="layui-icon layui-icon-search"></i>
                        </button>
                        <button type="reset" lay-filter="search" class="layui-btn layui-btn-sm layui-btn-primary table-action">
                            <i class="layui-icon layui-icon-refresh"></i>
                        </button>
                    </div>
                </form>
            </div>
            <table class="layui-hide" id="table-list"></table>
            <script type="text/html" id="shareTpl">
                <input type="checkbox" value="{{d.id}}" lay-skin="switch" lay-text="公开|私有" lay-filter="share" {{d.share?"checked":""}}>
            </script>
            <script type="text/html" id="statusTpl">
                <input type="checkbox" value="{{d.id}}" lay-skin="switch" lay-text="正常|冻结" lay-filter="status" {{d.enabled?"checked":""}}>
            </script>
            <script type="text/html" id="toolbar">
                <button type="button" class="layui-btn layui-btn-xs layui-btn-normal" lay-event="add">
                    <i class="layui-icon layui-icon-addition">新增</i>
                </button>
                <button type="button" class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">
                    <i class="layui-icon layui-icon-delete" title="删除">删除</i>
                </button>
            </script>
            <script type="text/html" id="column-toolbar">
                <button type="button" class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit">
                    <i class="layui-icon layui-icon-edit" title="编辑">编辑</i>
                </button>
                <button type="button" class="layui-btn layui-bg-orange layui-btn-xs" lay-event="answer">
                    <i class="layui-icon layui-icon-edit" title="答案">答案</i>
                </button>
            </script>
        </div>
    </div>
</div>
<script>
    layui.use(['jquery', 'table', 'form', 'layer'], function ($, table, form, layer) {
        table.render({
            elem: '#table-list',
            url: '/admin/lms/question/list',
            method: 'post',
            dataType: 'JSON',
            smartReloadModel: true,
            height: 'full-160',
            page: true,
            toolbar: '#toolbar',
            cols: [ [
                {type: 'checkbox'},
                {type: "numbers", title: '序号', minWidth: 120, templet: function(index){return index+1;}},
                {field: 'examSubjectName', title: '分类名', minWidth: 100},
                {field: 'mold', title: '题类型', width: 100,templet:function (d) {return d.mold==0 ? "单选" : d.mold==1 ? "多选" : "判断";}},
                {field: 'content', title: '内容', minWidth: 120},
                {field: 'difficulty', title: '难度等级', width: 100},
                {field: 'share', title: '分享', align: 'center', templet: "#shareTpl", width: 100},
                {field: 'enabled', title: '状态', align: 'center', templet: "#statusTpl", width: 100},
                {fixed: 'right', title: '操作', align: 'center', toolbar: '#column-toolbar', width: 150}
            ] ]
        });

        // 工具条点击事件
        table.on('toolbar', function (obj) {
            if (obj.event === 'add') {
                editView("/admin/lms/question/edit", "添加");
            } else if (obj.event === 'del') {
                layer.confirm('真的删除行么?', function (index) {
                    let selectData = table.checkStatus('table-list').data;
                    if (selectData.length > 0) {
                        let idsArray = [];
                        for (let i = 0; i < selectData.length; i++) {
                            idsArray.push(selectData[i].id);
                        }
                        let ids = idsArray.toString();
                        deleteReq(ids, '/admin/lms/question/del')
                        layer.close(index);
                    }
                });
            }
        });

        table.on('tool', function (obj) {
            let data = obj.data, event = obj.event;
            if (event === 'edit') {
                editView("/admin/lms/question/edit?id=" + data.id, "编辑");
            }else if (event === 'answer') {
                openFull("/admin/lms/question/answer/list?id=" + data.id, "答案");
            }
        });

        form.on('switch(share)', function (obj) {
            modifyReq('/admin/lms/question/setShare', {id: obj.value}, false);
        });

        form.on('switch(status)', function (obj) {
            modifyReq('/admin/lms/question/setState', {id: obj.value}, false);
        });

        form.on('submit(search)', function (form) {
            table.reload('table-list', {
                where: form.field
            });
            return false;
        });
    });
</script>
</body>
</html>