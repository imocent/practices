<!DOCTYPE HTML>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head th:include="include :: head('答题室列表')"></head>
<body>
<div class="layui-card">
    <div class="layui-card-body">
        <div class="yadmin-body animated fadeIn">
            <div class="layui-form yadmin-search-area input">
                <form class="layui-form-item">
                    <div class="layui-inline">
                        <label for="name" class="layui-form-label">名称</label>
                        <div class="layui-input-inline">
                            <input type="text" name="name" id="name" placeholder="名称" class="layui-input"/>
                        </div>
                        <button lay-submit="" lay-filter="search" class="layui-btn layui-btn-sm layui-btn-primary table-action">
                            <i class="layui-icon layui-icon-search"></i>
                        </button>
                        <button type="reset" lay-filter="search" class="layui-btn layui-btn-sm layui-btn-primary table-action">
                            <i class="layui-icon layui-icon-refresh"></i>
                        </button>
                    </div>
                </form>
            </div>
            <table class="layui-hide" id="table-list"></table>
            <script type="text/html" id="toolbar">
                <button type="button" class="layui-btn layui-btn-xs layui-btn-normal" lay-event="add">
                    <i class="layui-icon layui-icon-addition">新增</i>
                </button>
                <button type="button" class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">
                    <i class="layui-icon layui-icon-delete" title="删除">删除</i>
                </button>
            </script>
            <script type="text/html" id="column-toolbar">
                <button type="button" class="layui-btn layui-btn-normal layui-btn-xs" lay-event="edit">
                    <i class="layui-icon layui-icon-edit" title="编辑">编辑</i>
                </button>
                <button type="button" class="layui-btn layui-btn-xs" lay-event="desc">
                    <i class="layui-icon layui-icon-edit" title="答题室说明">说明</i>
                </button>
            </script>
        </div>
    </div>
</div>
<script>
    layui.use(['jquery', 'table', 'form', 'layer'], function ($, table, form, layer) {
        table.render({
            elem: '#table-list',
            url: '/admin/lms/exam/room/list',
            method: 'post',
            dataType: 'JSON',
            smartReloadModel: true,
            page: true,
            toolbar: '#toolbar',
            cols: [ [
                {type: 'checkbox', fixed: 'left'},
                {field: 'subjectName', title: '业务分类', minWidth: 100, fixed: 'left'},
                {field: 'title', title: '答题室标题', width: 100, fixed: 'left'},
                {field: 'enabled', title: '答题室状态', width: 100},
                {field: 'examMode', title: '答卷模式', width: 100},
                {field: 'timeMode', title: '时间类型', width: 120,templet: function (d) {return d.timeMode ? "限时" : "永久";}},
                {field: 'timeLen', title: '答题时长', width: 100},
                {field: 'timeOn', title: '开始时间', width: 120},
                {field: 'timeOff', title: '结束时间', width: 120},
                {field: 'examineeCount', title: '答题次数', width: 100},
                {field: 'examineeMode', title: '人员类型', width: 100,templet: function (d) {
                    return d.examineeMode ? "指定人员" : "任何人员";
                }},
                {field: 'subjectSortMode', title: '题目顺序', width: 100,align: 'center',templet: function (d) {
                    return d.subjectSortMode ? "随机" : "固定";
                }},
                {field: 'subjectOptSortMode', title: '选项顺序', width: 100,align: 'center',templet: function (d) {
                    return d.subjectOptSortMode ? "随机" : "固定";
                }},
                {field: 'markMode', title: '阅卷类型', width: 100,templet: function (d) {
                    return d.markMode ? "人工" : "自动";
                }},
                {field: 'adjudgeMode', title: '判卷类型', width: 100,templet: function (d) {
                    return d.adjudgeMode ? "全场收卷后" : "用户交卷后";
                }},
                {field: 'markShowMode', title: '发布成绩时间', width: 120,templet: function (d) {
                    return d.markShowMode == 1 ? "得分" : d.markShowMode == 2 ? "答卷" : "得分&答卷";
                }},
                {field: 'markTimeMode', title: '发布成绩类型', width: 120,templet: function (d) {
                    return d.markTimeMode == 1 ? "全场阅卷后" : d.markTimeMode == 2 ? "答卷阅卷后" : "不发布";
                }},
                {field: 'uuid', title: 'UUID', width: 300},
                {fixed: 'right', title: '操作', align: 'center', width: 150, toolbar: '#column-toolbar'}
            ] ]
        });

        // 工具条点击事件
        table.on('toolbar', function (obj) {
            if (obj.event === 'add') {
                editView("/admin/lms/exam/room/edit", "添加");
            } else if (obj.event === 'del') {
                layer.confirm('真的删除行么?', function (index) {
                    let selectData = table.checkStatus('table-list').data;
                    if (selectData.length > 0) {
                        let idsArray = [];
                        for (let i = 0; i < selectData.length; i++) {
                            idsArray.push(selectData[i].id);
                        }
                        let ids = idsArray.toString();
                        deleteReq(ids, '/admin/lms/top/del')
                        layer.close(index);
                    }
                });
            }
        });

        table.on('tool', function (obj) {
            let data = obj.data, event = obj.event;
            if (event === 'edit') {
                editView("/admin/lms/exam/room/edit?id=" + data.id, "编辑");
            } else if (event === 'desc') {
                openHtml('答题室说明', data.notes);
            }
        });

        form.on('submit(search)', function (form) {
            table.reload('table-list', {
                where: form.field
            });
            return false;
        });
    });
</script>
</body>
</html>