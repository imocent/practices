<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:include="include :: head('做题吧 - 修改密码')"></head>
<body>
<div class="layui-container layui-fluid">
    <div class="layui-row layui-card">
        <div class="layui-card-header"><i class="layui-icon">&#xe673; 修改密码</i></div>
        <div class="layui-card-body layui-form">
            <div class="layui-form-item">
                <label class="layui-form-label">当前密码</label>
                <div class="layui-input-block">
                    <input type="password" name="oldPassword" lay-verify="required" placeholder="6到16个字符" class="layui-input"/>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">新密码</label>
                <div class="layui-input-block">
                    <input type="password" id="npw" name="password" lay-verify="required" placeholder="6到16个字符" class="layui-input"/>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">确认新密码</label>
                <div class="layui-input-block">
                    <input type="password" id="cpw" name="newPassword" lay-verify="repass" placeholder="6到16个字符" class="layui-input"/>
                </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button class="layui-btn layui-bg-purple" lay-submit lay-filter="lay_submit">确认修改</button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 底部信息 -->
<script>
    layui.use(['jquery', 'form'], function ($, form) {
        form.verify({
            repass: function (data, obj, first) {
                if (data === '') {
                    return '必填项不能为空';
                } else if (data !== $('#npw').val()) {
                    return '两次密码不一致';
                }
            }
        });
        form.on('submit(lay_submit)', function (obj) {
            $.post('/user/account/save', obj.field, function (data) {
                if (data.code === -1) {
                    layer.msg(data.msg, {icon: 5, time: 1000});
                } else {
                    layer.msg(data.msg, {icon: 6, time: 2000, end: function () {window.location.reload();}});
                }
            }, 'json').fail(function (event) {
                console.log(event)
                console.log(event.responseText)
                layer.msg(event.responseText, {icon: 5, time: 1000});
            });
        });
    });
</script>
</body>
</html>